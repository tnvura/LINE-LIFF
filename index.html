<!-- File: /index.html (Survey LIFF — Pro UI, design-only refresh; same JS & IDs) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Customer Survey</title>

  <!-- Modern font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --brand: #06c755; /* LINE green */
      --brand-600: #05a74a;
      --text: #0f172a; /* slate-900 */
      --muted: #475569; /* slate-600 */
      --bg: #f6f7fb; /* soft light */
      --card: #ffffff;
      --ring: rgba(6, 199, 85, 0.25);
      --border: #e5e7eb;
      --shadow: 0 1px 2px rgba(16, 24, 40, .06), 0 12px 24px rgba(16, 24, 40, .06);
      --radius: 14px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }

    body {
      margin: 0;
      font-family: Inter, -apple-system, Segoe UI, Roboto, Helvetica, Arial, system-ui, sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 500px at 20% -10%, rgba(6,199,85,0.07), transparent 50%),
                  radial-gradient(900px 400px at 120% 0%, rgba(6,199,85,0.06), transparent 60%),
                  var(--bg);
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 24px;
    }

    .container {
      width: 100%;
      max-width: 680px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: calc(var(--radius) + 2px);
      box-shadow: var(--shadow);
      padding: 28px;
    }

    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; }
    .title {
      margin: 0 0 6px;
      font-size: clamp(22px, 3vw, 26px);
      font-weight: 700;
      letter-spacing: -0.02em;
    }
    .subtitle { margin: 0; color: var(--muted); font-size: 14px; }

    /* Status pill */
    .status { margin-top: 16px; }
    .status .pill {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 10px 12px; border-radius: 999px; font-weight: 600; font-size: 13px;
      border: 1px solid var(--border); background: #f8fafc; color: var(--muted);
    }
    .status.success .pill { background: #effdf5; color: #036b26; border-color: #b7f0cd; }
    .status.error .pill { background: #fff1f2; color: #b91c1c; border-color: #fecaca; }
    .status.loading .pill { background: #fefce8; color: #854d0e; border-color: #fde68a; }

    /* Form */
    .survey-form { margin-top: 22px; padding-top: 6px; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 560px) { .grid.two { grid-template-columns: 1fr 1fr; } }

    .form-group { display: grid; gap: 8px; }
    .label { font-size: 13px; font-weight: 600; color: var(--muted); }

    .input, .select {
      width: 100%;
      height: 44px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 15px;
      transition: box-shadow .2s ease, border-color .2s ease, background .2s ease;
    }
    .input::placeholder { color: #94a3b8; }
    .input:focus, .select:focus { outline: none; border-color: var(--brand); box-shadow: 0 0 0 4px var(--ring); }

    /* Custom select arrow */
    .select { appearance: none; background-image:
      linear-gradient(45deg, transparent 50%, #64748b 50%),
      linear-gradient(135deg, #64748b 50%, transparent 50%),
      linear-gradient(#e5e7eb 0 0);
      background-position: calc(100% - 18px) calc(1em + 2px), calc(100% - 13px) calc(1em + 2px), calc(100% - 44px) 50%;
      background-size: 6px 6px, 6px 6px, 1px 28px; background-repeat: no-repeat;
      padding-right: 44px;
    }

    /* Checkbox chips */
    .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; }
    .chip {
      position: relative; display: inline-flex; align-items: center; gap: 10px;
      padding: 10px 14px; border: 1px solid var(--border); border-radius: 999px;
      background: #fff; cursor: pointer; user-select: none; font-weight: 600; color: var(--text);
      transition: border-color .2s ease, box-shadow .2s ease, background .2s ease;
    }
    .chip:hover { border-color: #cbd5e1; }
    .chip input { position: absolute; inset: 0; opacity: 0; }
    .chip .box {
      width: 18px; height: 18px; border-radius: 5px; border: 2px solid #cbd5e1; display: grid; place-items: center;
      transition: all .18s ease;
    }
    .chip input:checked + .box { background: var(--brand); border-color: var(--brand); box-shadow: 0 0 0 3px var(--ring); }
    .chip input:checked + .box::after { content: '\2713'; color: #fff; font-size: 12px; font-weight: 900; transform: translateY(-1px); }

    /* Buttons */
    .button-group { display: grid; gap: 10px; grid-template-columns: 1fr; margin-top: 18px; }
    @media (min-width: 560px) { .button-group { grid-template-columns: 1fr 1fr; } }

    .btn { height: 44px; border-radius: 12px; border: 1px solid transparent; font-weight: 700; font-size: 15px; cursor: pointer; }
    .btn-primary { background: var(--brand); color: #fff; }
    .btn-primary:hover { background: var(--brand-600); }
    .btn-primary:focus { outline: none; box-shadow: 0 0 0 4px var(--ring); }

    .btn-secondary { background: #fff; color: var(--text); border-color: var(--border); }
    .btn-secondary:hover { border-color: #cbd5e1; }

    .btn:disabled { opacity: .6; cursor: not-allowed; }

    /* Webhook response panel */
    .webhook-response { display: none; margin-top: 18px; border: 1px solid var(--border); border-radius: 12px; background: #f8fafc; padding: 14px; }
    .webhook-response h4 { margin: 0 0 8px; font-size: 13px; color: var(--muted); }
    #responseData { margin: 0; max-height: 220px; overflow: auto; background: #111827; color: #e5e7eb; padding: 12px; border-radius: 8px; font: 12px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }

    /* Accessibility & motion */
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,1px,1px); white-space: nowrap; border: 0; }
    @media (prefers-reduced-motion: reduce) { * { transition: none !important; } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1 class="title">📋 Customer Survey</h1>
        <p class="subtitle">Help us understand your needs. It takes less than a minute.</p>
      </div>
      <div class="sr-only" aria-live="polite" id="aria-status"></div>
    </header>

    <div id="status" class="status loading"><span class="pill">Initializing LIFF…</span></div>

    <form id="surveyForm" class="survey-form" style="display:none" novalidate>
      <div class="grid two">
        <div class="form-group">
          <label class="label" for="customerName">Customer Name *</label>
          <input class="input" type="text" id="customerName" name="customerName" required placeholder="Enter customer name" />
        </div>
        <div class="form-group">
          <label class="label" for="companyName">Company Name *</label>
          <input class="input" type="text" id="companyName" name="companyName" required placeholder="Enter company name" />
        </div>
      </div>

      <div class="grid two">
        <div class="form-group">
          <label class="label" for="segment">Segment *</label>
          <select class="select" id="segment" name="segment" required>
            <option value="">Select segment…</option>
            <option value="standalone-restaurant">Standalone Restaurant</option>
            <option value="chain-restaurant">Chain Restaurant</option>
          </select>
        </div>
        <div class="form-group">
          <label class="label" for="pricePeriod">Price Period *</label>
          <select class="select" id="pricePeriod" name="pricePeriod" required>
            <option value="">Select price period…</option>
            <option value="7-days">7 days</option>
            <option value="15-days">15 days</option>
            <option value="30-days">30 days</option>
            <option value="60-days">60 days</option>
            <option value="90-days">90 days</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <span class="label">Payment Method *</span>
        <div class="checkbox-group">
          <label class="chip">
            <input type="checkbox" name="paymentMethod" value="cash" />
            <span class="box" aria-hidden="true"></span>
            Cash
          </label>
          <label class="chip">
            <input type="checkbox" name="paymentMethod" value="credit-term" />
            <span class="box" aria-hidden="true"></span>
            Credit Term
          </label>
        </div>
      </div>
    </form>

    <div class="button-group" id="buttonGroup" style="display:none">
      <button id="submitButton" class="btn btn-primary" onclick="submitSurvey()">📤 Submit</button>
      <button id="resetButton" class="btn btn-secondary" onclick="resetForm()">🔄 Reset</button>
    </div>

    <div id="webhookResponse" class="webhook-response">
      <h4>Webhook Response</h4>
      <pre id="responseData"></pre>
    </div>
  </div>

  <!-- LINE LIFF SDK -->
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <!--
    IMPORTANT: JS below is kept functionally the same as your original file.
    Only minor non-functional tweaks (aria-live updates) were added for UX.
  -->
  <script>
    const LIFF_ID = '2008075804-2AER9wYe';
    const WEBHOOK_URL = 'https://n8n.tnvura.dev/webhook-test/1044c42f-7f8b-419f-8b02-9650a47623c0';

    let userProfile = null;

    async function initializeLiff() {
      try {
        await liff.init({ liffId: LIFF_ID });
        if (liff.isLoggedIn()) {
          updateStatus('✅ LIFF initialized successfully!', 'success');
          await getUserProfile();
        } else {
          updateStatus('❌ User not logged in', 'error');
          liff.login();
        }
      } catch (error) {
        console.error('LIFF initialization failed:', error);
        updateStatus(`❌ LIFF init failed: ${error.message}`, 'error');
      }
    }

    async function getUserProfile() {
      try {
        userProfile = await liff.getProfile();
        document.getElementById('surveyForm').style.display = 'block';
        document.getElementById('buttonGroup').style.display = 'grid';
      } catch (error) {
        console.error('Failed to get profile:', error);
        updateStatus(`❌ Failed to get profile: ${error.message}`, 'error');
      }
    }

    async function submitSurvey() {
      if (!userProfile) {
        updateStatus('❌ No user profile available', 'error');
        return;
      }

      const form = document.getElementById('surveyForm');
      if (!form.checkValidity()) {
        updateStatus('❌ Please fill in all required fields', 'error');
        return;
      }

      const paymentMethods = document.querySelectorAll('input[name="paymentMethod"]:checked');
      if (paymentMethods.length === 0) {
        updateStatus('❌ Please select at least one payment method', 'error');
        return;
      }

      updateStatus('📤 Submitting survey…', 'loading');
      document.getElementById('submitButton').disabled = true;

      const formData = {
        customerName: document.getElementById('customerName').value.trim(),
        companyName: document.getElementById('companyName').value.trim(),
        segment: document.getElementById('segment').value,
        pricePeriod: document.getElementById('pricePeriod').value,
        paymentMethods: Array.from(paymentMethods).map(cb => cb.value)
      };

      const webhookData = {
        timestamp: new Date().toISOString(),
        liffId: LIFF_ID,
        survey: formData,
        lineUser: {
          userId: userProfile.userId,
          displayName: userProfile.displayName
        },
        context: {
          type: liff.getContext()?.type || 'unknown',
          viewType: liff.getContext()?.viewType || 'unknown'
        }
      };

      try {
        const response = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(webhookData)
        });

        const responseText = await response.text();
        let responseData;
        try { responseData = JSON.parse(responseText); } catch { responseData = responseText; }

        if (response.ok) {
          updateStatus('✅ Survey submitted successfully!', 'success');
          showWebhookResponse(responseData);
        } else {
          updateStatus(`❌ Submission failed: ${response.status} ${response.statusText}`, 'error');
          showWebhookResponse(responseData);
        }
      } catch (error) {
        console.error('Submission error:', error);
        updateStatus(`❌ Submission error: ${error.message}`, 'error');
      } finally {
        document.getElementById('submitButton').disabled = false;
      }
    }

    function resetForm() {
      document.getElementById('surveyForm').reset();
      document.getElementById('webhookResponse').style.display = 'none';
      updateStatus('✅ LIFF initialized successfully!', 'success');
    }

    function showWebhookResponse(data) {
      const responseElement = document.getElementById('responseData');
      responseElement.textContent = JSON.stringify(data, null, 2);
      document.getElementById('webhookResponse').style.display = 'block';
    }

    function updateStatus(message, type = '') {
      const statusElement = document.getElementById('status');
      const aria = document.getElementById('aria-status');
      statusElement.className = `status ${type}`;
      statusElement.innerHTML = `<span class="pill">${message}</span>`;
      aria.textContent = message; // why: surface status to screen readers
    }

    window.addEventListener('DOMContentLoaded', initializeLiff);
  </script>
</body>
</html>
