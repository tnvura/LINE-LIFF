<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LIFF App with n8n</title>
</head>
<body>

  <h1>Welcome to my LIFF App!</h1>
  <div id="profile-info"></div>
  <p id="status">Initializing LIFF...</p>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <script>
    // âœ¨ NEW FUNCTION TO SEND DATA âœ¨
    async function sendToN8n(profileData) {
      document.getElementById("status").innerText = "Sending data to workflow...";
      
      const n8nWebhookUrl = "https://n8n.tnvura.dev/webhook-test/1044c42f-7f8b-419f-8b02-9650a47623c0"; // ðŸ‘ˆ PASTE YOUR N8N TEST URL

      try {
        await fetch(n8nWebhookUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(profileData),
        });
        document.getElementById("status").innerText = "Data sent successfully!";
      } catch (e) {
        document.getElementById("status").innerText = "Error sending data: " + e.message;
      }
    }

    async function initializeLiff() {
      try {
        await liff.init({ liffId: "2008075804-2AER9wYe" });

        if (!liff.isLoggedIn()) {
          liff.login();
        } else {
          const profile = await liff.getProfile();
          
          document.getElementById("profile-info").innerHTML = `
            <h2>Hello, ${profile.displayName}!</h2>
          `;
          
          // Call the new function to send the profile data
          await sendToN8n(profile); 
        }
      } catch (e) {
        document.getElementById("status").innerText = "Error initializing LIFF: " + e.message;
      }
    }

    initializeLiff();
  </script>

</body>
</html>
